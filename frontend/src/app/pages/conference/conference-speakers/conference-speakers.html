<h2 class="page-title">
  {{
    'CONFERENCE.SPEAKERS.TITLE_PAGE'
      | translate
        : {
            conference: ((conference()?.name || '') + (conference()?.edition ? ' ' + conference()?.edition : '')).trim()
          }
  }}
</h2>

<p-dataview
  class="speaker-dataview"
  [value]="filteredSpeakerViews()"
  [paginator]="true"
  [rows]="10"
  layout="list"
  [loading]="loading()"
  [showCurrentPageReport]="true"
  currentPageReportTemplate="{first} - {last} / {totalRecords}"
>
  <ng-template #header>
    <div class="speaker-toolbar">
      <div class="toolbar-row row-1">
        <p-multiselect
          [options]="sessionTypeOptions()"
          [ngModel]="selectedSessionTypeIds()"
          (ngModelChange)="selectedSessionTypeIds.set($event)"
          optionLabel="label"
          optionValue="value"
          display="chip"
          [showToggleAll]="false"
          [placeholder]="'CONFERENCE.SPEAKERS.FILTER_SESSION_TYPE' | translate"
          class="header-control"
        ></p-multiselect>

        <input
          pInputText
          type="text"
          [ngModel]="searchText()"
          (ngModelChange)="searchText.set($event)"
          [placeholder]="'CONFERENCE.SPEAKERS.FILTER_SEARCH' | translate"
          class="header-control header-search"
        />
      </div>

      <div class="toolbar-row row-2">
        <div class="filter-checkbox">
          <p-checkbox
            inputId="has-unavailable-slot-filter"
            [binary]="true"
            [ngModel]="hasUnavailableSlotFilter()"
            (ngModelChange)="hasUnavailableSlotFilter.set(!!$event)"
          ></p-checkbox>
          <label for="has-unavailable-slot-filter">
            {{ 'CONFERENCE.SPEAKERS.FILTER_HAS_UNAVAILABLE_SLOT' | translate }}
          </label>
        </div>
        <div class="filter-checkbox">
          <p-checkbox
            inputId="has-multiple-sessions-filter"
            [binary]="true"
            [ngModel]="hasMultipleSessionsFilter()"
            (ngModelChange)="hasMultipleSessionsFilter.set(!!$event)"
          ></p-checkbox>
          <label for="has-multiple-sessions-filter">
            {{ 'CONFERENCE.SPEAKERS.FILTER_HAS_MULTIPLE_SESSIONS' | translate }}
          </label>
        </div>

        <div class="speaker-count">
          {{
            'CONFERENCE.SPEAKERS.COUNT'
              | translate
                : {
                    filtered: filteredSpeakerViews().length,
                    total: speakerViews().length
                  }
          }}
        </div>

        <button
          pButton
          type="button"
          icon="pi pi-plus"
          [label]="'CONFERENCE.SPEAKERS.ADD_SPEAKER' | translate"
          class="add-speaker-button"
          (click)="onAddSpeaker()"
        ></button>
      </div>
    </div>
  </ng-template>

  <ng-template #list let-items>
    <div class="speaker-list">
      @for (view of items; track view.conferenceSpeaker.id) {
        <div
          class="speaker-card"
          role="button"
          tabindex="0"
          (click)="openSpeakerEdit(view)"
          (keydown.enter)="openSpeakerEdit(view)"
          (keydown.space)="openSpeakerEdit(view); $event.preventDefault()"
          [class.missing-person]="!view.person"
        >
          <div class="speaker-line-1">
            <div class="speaker-main">
              <span class="speaker-name">
                {{ view.fullName || ('CONFERENCE.SPEAKERS.UNKNOWN_SPEAKER' | translate) }}
              </span>
              @if (view.company) {
                <span class="speaker-company">({{ view.company }})</span>
              }
              @if (view.person?.email) {
                <span class="speaker-email">{{ view.person?.email }}</span>
              }
            </div>
            <div class="speaker-meta">
              @if (view.unavailableSlotsCount > 0) {
                <span class="meta-badge">
                  {{ 'CONFERENCE.SPEAKERS.UNAVAILABLE_SLOTS' | translate }}
                </span>
              }
              @for (countByType of view.sessionTypeCounts; track countByType.sessionTypeId) {
                <span
                  class="meta-badge"
                  [style.background-color]="countByType.backgroundColor"
                  [style.color]="countByType.textColor"
                >
                  {{ countByType.sessionTypeLabel }}: {{ countByType.count }}
                </span>
              }
            </div>
          </div>
        </div>
      }
    </div>
  </ng-template>

  <ng-template #emptymessage>
    <div class="empty-message">{{ 'CONFERENCE.SPEAKERS.EMPTY' | translate }}</div>
  </ng-template>
</p-dataview>
